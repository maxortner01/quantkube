# DO NOT CHANGE
# THIS FILE IS AUTOGENERATED
# See deploy.py

{{ external_container }} 

# Generate schemas
FROM base-env AS schemas

COPY --from=external_deps /external/flatbuffers /external/flatbuffers

COPY ./api ./api
RUN ./external/flatbuffers/flatc --cpp -o ./schemas ./api/*.fbs 

# Compile and run the service
FROM base-env

COPY --from=external_deps /external /external
COPY --from=schemas       /schemas  /schemas
COPY {{ service_dir  }} .

RUN cmake . && make -j

ENTRYPOINT ["./{{ name }}"]