# DO NOT CHANGE
# THIS FILE IS AUTOGENERATED
# See deploy.py

FROM gcc:latest AS external_deps

RUN apt-get update && apt-get install -y \
    cmake \
    git \
    build-essential \
    && rm -rf /var/lib/apt/lists/*

COPY {{ external_dir }} ./external

RUN cd ./external/flatbuffers && cmake . && make -j

COPY ./api ./api
RUN ./external/flatbuffers/flatc --cpp -o ./schemas ./api/*.fbs 

FROM gcc:latest

COPY --from=external_deps /external /external
COPY --from=external_deps /schemas /schemas
COPY {{ service_dir  }} .

RUN apt update && apt install -y cmake

RUN cmake . && make -j

CMD ["./{{ name }}"]